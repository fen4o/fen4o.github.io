---
layout: post
title:  "Как Offnews дава цялата информация за всеки коментар"
date:   2015-09-12 18:30:00
categories: blog
tags: bg
---

В този пост ще се разгледаме как да **не** пишем сайт от гледна точка главно на
безопасността. Днешната цел ще е <http://offnews.bg>.

Проблеми:

*   Можете по всяко време да разберете IP адрес + email на всеки потребител,
    който е коментирал.  Как? Просто посещавате
    `<http://offnews.bg/requests.php?act=opinion&opid={id}>` и заменяте `{id}` с
    номерът на коментара, който искате да видите.  А как намерите този номер?
    Ако сте с Google Chrome - докато сте с мишката над коментар - дясно копче,
    Inspect element и търсите нещо от този сорт `<div class="comment_info"
    id="opХХХХХХ">` , където ХХХХХХ е числото, което ви трябва.  Пример:
    ![Random comment](/images/offnews/offnews-request1.jpg) Проблемът в горната
    картинка е че се виждат няколко неща (цензурирани са за запазване на личните
    данни на потребителя):
    1. IP адрес
    1. email
    1. име
    1. коментар
    1. дата и час
    1. браузър

    Тривиално е да се направи crawer, който да мине през всички коментари и да
    вземе много емейл адреси за спам. А и буквално могат да ви намерят по IP
    адреса.

*   Системата за гласуване е IP адрес базирана. Т.е. ако имате достатъчно проксита
    или достатъчно голям ботнет можете без проблем да "премахнете" неудобните
    коментари. Също, защото одобряването на коментари от новите потребители
    изисква одобрение от администратор, може да по същия начин да се наспами
    опашката за одобрение на коментари.

*   Няма по подразбиране HTTPS. т.е. когато влизате на сайта, той не ви прехвърля
    автоматично към криптираната версия (<https://offnews.bg>). Да не говорим,
    че дори и когато сте на нея, част от ресурсите пак се зареждат, без
    криптиране (през http).

*   [robots.txt](http://offnews.bg/robots.txt), много добре разкрива къде е
    администраторската част на сайта. Още по-интересно е че там има само една
    определена [новина](http://offnews.bg/news/%D0%9E%D0%B1%D1%89%D0%B0_18756/%D0%91%D1%8A%D0%BB%D0%B3%D0%B0%D1%80%D1%81%D0%BA%D0%B0-%D0%BA%D0%BE%D0%BC%D0%BF%D0%B0%D0%BD%D0%B8%D1%8F-%D0%B8%D0%B7%D1%81%D0%BB%D0%B5%D0%B4%D0%B2%D0%B0-%D0%B2%D1%8A%D0%B7%D0%BC%D0%BE%D0%B6%D0%BD%D0%BE%D1%81%D1%82%D0%B8-%D0%B7%D0%B0-%D0%BF%D1%80%D0%B8%D0%BB%D0%B0%D0%B3%D0%B0%D0%BD%D0%B5-%D0%BD%D0%B0-%D0%BD%D0%BE%D0%B2-%D0%BC%D0%B5%D1%82%D0%BE%D0%B4-%D0%B7%D0%B0-%D0%BE%D1%81%D1%8A%D1%89%D0%B5%D1%81%D1%82%D0%B2%D1%8F%D0%B2%D0%B0%D0%BD%D0%B5-%D0%BD%D0%B0-%D0%BA%D0%BE%D0%BC%D0%BF%D0%BB%D0%B5%D0%BA%D1%81%D0%BD%D0%B8-%D0%B7%D0%B0%D0%B4%D0%B0%D1%87%D0%B8-%D0%B8-%D1%80%D0%B0%D0%B7%D0%BF%D0%BB%D0%B0%D1%89%D0%B0%D0%BD%D0%B5-%D0%B2-%D0%B8%D0%BD%D1%82%D0%B5%D1%80%D0%BD%D0%B5%D1%82_504714.html)
    [1](http://pastebin.com/SZX7Xni8). Доста интересно е и съдържанието и, но
    това оставям за друг път.

    Това не е свързано със беопасността, но дразни - без какъвто и да е [ad
    blocker](https://chrome.google.com/webstore/detail/ublock-origin/cjpalhdlnbpafiamejdnhcphjbkeiagm?hl=bg)
    , на десктоп машина сайта прави умопомръчителните 300+ request-a, сваляйки
    около 3Mb+ данни. На мобилната весия нещата са малко по-добре: 120 request-a
    и 700kb.  Ad blocker нещата изглеждат така 214 requests, 2.2Mb, а на
    мобилната весия: 114 requests, 442Kb [за тази
    новина](http://m.offnews.bg/news/%D0%9F%D0%BE%D0%BB%D0%B8%D1%82%D0%B8%D0%BA%D0%B0_8/%D0%95%D0%B4%D0%B8%D0%BD-%D0%BE%D1%82-%D0%BF%D1%8A%D1%80%D0%B2%D0%B8%D1%82%D0%B5-%D0%B3%D0%BE%D0%BB%D0%B5%D0%BC%D0%B8-%D0%B8%D0%BC%D0%B8%D0%B3%D1%80%D0%B0%D0%BD%D1%82%D0%B8-%D0%B2-%D0%91%D1%8A%D0%BB%D0%B3%D0%B0%D1%80%D0%B8%D1%8F-%D0%B5-%D1%85%D0%B0%D0%BD-%D0%90%D1%81%D0%BF%D0%B0%D1%80%D1%83%D1%85_557367.html).
    Също на [PageSpeed](https://developers.google.com/speed/pagespeed/insights/?hl=en&utm_source=wmx&utm_campaign=wmx_otherlinks&url=http%3A%2F%2Foffnews.bg&tab=mobile)
    нещата не са много добре.

Това е за сега. Не съм пускал никакви penetration тестове срещу сайта (XSS, SQL
injection etc.), но ако някой желае - давайте и споделете резултатите.

f.
